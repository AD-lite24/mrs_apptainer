Bootstrap: docker
# Bootstrap: docker-daemon
From: ubuntu:20.04
# From: klaxalk/linux-setup:master

%post

    # fix prompts during installation
    apt-get -y update
    apt-get -y install sudo
    echo 'debconf debconf/frontend select Noninteractive' | sudo debconf-set-selections
    sudo apt-get install -y -q
    DEBIAN_FRONTEND=noninteractive sudo apt-get -y install keyboard-configuration

    sudo apt-get -y install curl

    curl https://ctu-mrs.github.io/ppa-unstable/add_ros_ppa.sh | bash
    apt-get -y install ros-noetic-desktop-full

    curl https://ctu-mrs.github.io/ppa-unstable/add_ppa.sh | bash
    apt-get -y install ros-noetic-mrs-uav-system-full

    # location for the singularity files
    export MRS_LOCATION=/opt/mrs
    mkdir -p $MRS_LOCATION

    # link configuration file for the MRS env
    ln -s $MRS_LOCATION/host/99-mrs_env.sh /.singularity.d/env/99-mrs_env.sh

    # link configuration file for the linux-setup env
    ln -s $MRS_LOCATION/host/99-linux_setup_env.sh /.singularity.d/env/99-linux_setup_env.sh

%environment
    export LC_ALL=C

%runscript
  CMD="${@}"

  if [ -z "${CMD}" ]; then
    /bin/bash --login
  else
    /bin/bash --login -c "${CMD}"
  fi

  exit 0
