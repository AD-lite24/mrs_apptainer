Bootstrap: docker
# From: klaxalk/linux-setup:master
From: ubuntu:20.04

%post

    # fix prompts during installation
    apt-get -y update
    apt-get -y install sudo
    echo 'debconf debconf/frontend select Noninteractive' | sudo debconf-set-selections
    sudo apt-get install -y -q
    DEBIAN_FRONTEND=noninteractive sudo apt-get -y install keyboard-configuration

    apt-get -y install wget vim ranger

    export MRS_LOCATION=/opt/mrs
    mkdir -p $MRS_LOCATION

    wget -O - https://raw.githubusercontent.com/ctu-mrs/ci_scripts/master/package_build/add_ros_ppa.sh | bash
    wget -O - https://raw.githubusercontent.com/ctu-mrs/ci_scripts/master/package_build/add_ctu_mrs_unstable_ppa.sh | bash

    apt-get -y install ros-noetic-ros-base ros-noetic-mrs-uav-system

    # link configuration file for the MRS env
    ln -s $MRS_LOCATION/host/99-mrs_env.sh /.singularity.d/env/99-mrs_env.sh

    # link configuration file for the linux-setup env
    ln -s $MRS_LOCATION/host/99-linux_setup_env.sh /.singularity.d/env/99-linux_setup_env.sh

%environment
    export LC_ALL=C

%runscript
  CMD="${@}"

  if [ -z "${CMD}" ]; then
    /bin/bash --login
  else
    /bin/bash --login -c "${CMD}"
  fi

  exit 0
